<!DOCTYPE html>
<html class="writer-html5" lang="en-gb" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Extending sfftk &mdash; sfftk v0.6.0.dev1 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="sfftk packages" href="sfftk.html" />
    <link rel="prev" title="Developing with sfftk" href="developing.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> sfftk
          </a>
              <div class="version">
                v0.6
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="toolkit.html">EMDB-SFF Toolkit (<code class="docutils literal notranslate"><span class="pre">sfftk</span></code>)</a></li>
<li class="toctree-l1"><a class="reference internal" href="converting.html">Converting Files To EMDB-SFF</a></li>
<li class="toctree-l1"><a class="reference internal" href="annotating.html">Annotating EMDB-SFF Segmentations</a></li>
<li class="toctree-l1"><a class="reference internal" href="misc.html">Miscellaneous Operations Using sfftk</a></li>
<li class="toctree-l1"><a class="reference internal" href="developing.html">Developing with <code class="docutils literal notranslate"><span class="pre">sfftk</span></code></a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Extending sfftk</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#adding-a-segmentation-file-format">Adding A Segmentation File Format</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#step-i-create-a-reader-module">Step I: Create a <strong>reader</strong> module</a></li>
<li class="toctree-l3"><a class="reference internal" href="#step-ii-create-a-format-adapter-module">Step II: Create a <strong>format</strong> adapter module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#example">Example:</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#step-iii-implement-a-convert-hook-in-the-sfftk-sff-handle-convert-function">Step III: Implement a <strong>convert hook</strong> in the <code class="xref py py-func docutils literal notranslate"><span class="pre">sfftk.sff.handle_convert()</span></code> function</a></li>
<li class="toctree-l3"><a class="reference internal" href="#step-iv-add-test-data-files-to-the-sfftk-test-data-folder">Step IV: Add test data files to the <code class="docutils literal notranslate"><span class="pre">sfftk/test_data</span></code> folder</a></li>
<li class="toctree-l3"><a class="reference internal" href="#step-v-add-unit-tests-in-the-sfftk-unittests-module">Step V: Add unit tests in the <code class="xref py py-mod docutils literal notranslate"><span class="pre">sfftk.unittests</span></code> module</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#adding-a-search-resource">Adding A Search Resource</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#step-i-add-the-resource-description">Step I: Add the resource description</a></li>
<li class="toctree-l3"><a class="reference internal" href="#step-ii-add-a-handler-to-return-the-correct-url">Step II: Add a handler to return the correct URL</a></li>
<li class="toctree-l3"><a class="reference internal" href="#step-iii-define-how-the-table-is-formated">Step III: Define how the table is formated</a></li>
<li class="toctree-l3"><a class="reference internal" href="#step-iv-write-tests-and-test">Step IV: Write tests and test</a></li>
<li class="toctree-l3"><a class="reference internal" href="#step-iv-write-documentation-for-the-new-resource">Step IV: Write documentation for the new resource</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="sfftk.html"><code class="docutils literal notranslate"><span class="pre">sfftk</span></code> packages</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">sfftk</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Extending sfftk</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/extending.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="extending-sfftk">
<h1><a class="toc-backref" href="#id2">Extending sfftk</a><a class="headerlink" href="#extending-sfftk" title="Permalink to this heading"></a></h1>
<div class="contents topic" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#extending-sfftk" id="id2">Extending sfftk</a></p>
<ul>
<li><p><a class="reference internal" href="#adding-a-segmentation-file-format" id="id3">Adding A Segmentation File Format</a></p>
<ul>
<li><p><a class="reference internal" href="#step-i-create-a-reader-module" id="id4">Step I: Create a <strong>reader</strong> module</a></p></li>
<li><p><a class="reference internal" href="#step-ii-create-a-format-adapter-module" id="id5">Step II: Create a <strong>format</strong> adapter module</a></p>
<ul>
<li><p><a class="reference internal" href="#example" id="id6">Example:</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#step-iii-implement-a-convert-hook-in-the-sfftk-sff-handle-convert-function" id="id7">Step III: Implement a <strong>convert hook</strong> in the <code class="xref py py-func docutils literal notranslate"><span class="pre">sfftk.sff.handle_convert()</span></code> function</a></p></li>
<li><p><a class="reference internal" href="#step-iv-add-test-data-files-to-the-sfftk-test-data-folder" id="id8">Step IV: Add test data files to the <code class="docutils literal notranslate"><span class="pre">sfftk/test_data</span></code> folder</a></p></li>
<li><p><a class="reference internal" href="#step-v-add-unit-tests-in-the-sfftk-unittests-module" id="id9">Step V: Add unit tests in the <code class="xref py py-mod docutils literal notranslate"><span class="pre">sfftk.unittests</span></code> module</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#adding-a-search-resource" id="id10">Adding A Search Resource</a></p>
<ul>
<li><p><a class="reference internal" href="#step-i-add-the-resource-description" id="id11">Step I: Add the resource description</a></p></li>
<li><p><a class="reference internal" href="#step-ii-add-a-handler-to-return-the-correct-url" id="id12">Step II: Add a handler to return the correct URL</a></p></li>
<li><p><a class="reference internal" href="#step-iii-define-how-the-table-is-formated" id="id13">Step III: Define how the table is formated</a></p></li>
<li><p><a class="reference internal" href="#step-iv-write-tests-and-test" id="id14">Step IV: Write tests and test</a></p></li>
<li><p><a class="reference internal" href="#step-iv-write-documentation-for-the-new-resource" id="id15">Step IV: Write documentation for the new resource</a></p></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="admonition-todo admonition" id="id1">
<p class="admonition-title">Todo</p>
<p>multifile
parser</p>
</div>
<section id="adding-a-segmentation-file-format">
<h2><a class="toc-backref" href="#id3">Adding A Segmentation File Format</a><a class="headerlink" href="#adding-a-segmentation-file-format" title="Permalink to this heading"></a></h2>
<p>There are five (5) steps involved.</p>
<ul class="simple">
<li><p>Step I: Create a <strong>reader</strong> module</p></li>
<li><p>Step II: Create a <strong>format</strong> adapter module</p></li>
<li><p>Step III: Implement a <strong>convert hook</strong> in the <code class="xref py py-func docutils literal notranslate"><span class="pre">sfftk.sff.handle_convert()</span></code> function</p></li>
<li><p>Step IV: Add test data files to the <code class="docutils literal notranslate"><span class="pre">sfftk/test_data</span></code> folder</p></li>
<li><p>Step V: Add unit tests in the <code class="xref py py-mod docutils literal notranslate"><span class="pre">sfftk.unittests</span></code> module</p></li>
</ul>
<section id="step-i-create-a-reader-module">
<span id="step-i"></span><h3><a class="toc-backref" href="#id4">Step I: Create a <strong>reader</strong> module</a><a class="headerlink" href="#step-i-create-a-reader-module" title="Permalink to this heading"></a></h3>
<p>The role of the reader module is to be the first point of contact with the application-specific segmentation file.</p>
<p>Each reader module <strong>must</strong> implement a <code class="docutils literal notranslate"><span class="pre">get_data(fn,</span> <span class="pre">*args,</span> <span class="pre">**kwargs)</span></code> function which takes the segmentation file’s name as a string together with optional positional and keyword arguments to be passed down the class chain. This function then returns a single <em>ad hoc</em> object that encapsulates the segmentation with a simple API faithful to the segmentation’s structure to access various attributes of the segmentation e.g. <code class="docutils literal notranslate"><span class="pre">headers</span></code>, <code class="docutils literal notranslate"><span class="pre">segments</span></code> etc.</p>
<p>The reader module <strong>must</strong> then be placed in the <code class="xref py py-mod docutils literal notranslate"><span class="pre">sfftk.readers</span></code> package and should be named as the extension followed by the word ‘reader’ e.g. for Segger files with a <code class="docutils literal notranslate"><span class="pre">.seg</span></code> extension this would be <code class="docutils literal notranslate"><span class="pre">segreader.py</span></code>.</p>
</section>
<section id="step-ii-create-a-format-adapter-module">
<span id="step-ii"></span><h3><a class="toc-backref" href="#id5">Step II: Create a <strong>format</strong> adapter module</a><a class="headerlink" href="#step-ii-create-a-format-adapter-module" title="Permalink to this heading"></a></h3>
<p>The format adapter is where the <em>ad hoc</em> segmentation object is <em>adapted</em> to the EMDB-SFF model.</p>
<p>The classes defined in this module represent a hierarchy describing a typical segmentation data structure. For the following discussion, please refer to the diagram below. (You might need to right-click and select an option to view the image in a new tab to see the image details.)</p>
<img alt="_images/segmentation_object_hierarchy.png" src="_images/segmentation_object_hierarchy.png" />
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Note that all classes are subclasses of <code class="xref py py-class docutils literal notranslate"><span class="pre">sfftk.formats.base.SegmentationType</span></code>, which <em>may</em> specify attributes and methods that apply to all subclasses. Currently, none are defined but it is envisaged that some may arise.</p>
</div>
<p>At the top of the hierarchy is a <code class="xref py py-class docutils literal notranslate"><span class="pre">sfftk.formats.base.Segmentation</span></code> subclass which hosts objects of two other classes:</p>
<ul class="simple">
<li><p>a <code class="xref py py-class docutils literal notranslate"><span class="pre">sfftk.formats.base.Header</span></code> subclass for all header related metadata such as segment colours, names, segmentation space parameters such as the bounding box etc., and</p></li>
<li><p>an iterable attribute called <code class="docutils literal notranslate"><span class="pre">segments</span></code> which is a container for <code class="xref py py-class docutils literal notranslate"><span class="pre">sfftk.formats.base.Segment</span></code> subclasses, each holding data for a single segment.</p></li>
</ul>
<p>Each <code class="xref py py-class docutils literal notranslate"><span class="pre">sfftk.formats.base.Segment</span></code> subclass will in turn host objects of the following classes:</p>
<ul class="simple">
<li><p>a <code class="xref py py-class docutils literal notranslate"><span class="pre">sfftk.formats.base.Annotation</span></code> subclass for segment annotation, and</p></li>
<li><p>one or more segment format subclasses: <code class="xref py py-class docutils literal notranslate"><span class="pre">sfftk.formats.base.Volume</span></code> for 3D volumes, <code class="xref py py-class docutils literal notranslate"><span class="pre">sfftk.formats.base.Mesh</span></code> for meshes, and/or <code class="xref py py-class docutils literal notranslate"><span class="pre">sfftk.formats.base.Shapes</span></code> for shape primitives</p></li>
</ul>
<p>Format adapter modules <strong>must</strong> be placed in the <code class="xref py py-mod docutils literal notranslate"><span class="pre">sfftk.formats</span></code> package and should be named as the segmentation file format’s extension e.g. for Segger files with a <code class="docutils literal notranslate"><span class="pre">.seg</span></code> extension this is <code class="docutils literal notranslate"><span class="pre">seg.py</span></code>.</p>
<p>Conversion is effected within each class by implementing a <code class="docutils literal notranslate"><span class="pre">convert()</span></code> method which takes the attributes obtained from the <em>ad hoc</em> segmentation object and uses them to populate fields in a corresponding EMDB-SFF attribute object. Given the hierarchy described above, the <code class="docutils literal notranslate"><span class="pre">convert()</span></code> method for objects higher up in the hierarchy may then invoke the <code class="docutils literal notranslate"><span class="pre">convert()</span></code> method of lower level objects when effecting their conversions. An example will be provided below.</p>
<section id="example">
<h4><a class="toc-backref" href="#id6">Example:</a><a class="headerlink" href="#example" title="Permalink to this heading"></a></h4>
<p>To make the above concrete, we outline how the <a class="reference internal" href="formats.html#module-sfftk.formats.seg" title="sfftk.formats.seg"><code class="xref py py-mod docutils literal notranslate"><span class="pre">sfftk.formats.seg</span></code></a> format adapter is implemented.</p>
<p>Segger segmentation files are represented using 3D volumes. Therefore, the <a class="reference internal" href="formats.html#module-sfftk.formats.seg" title="sfftk.formats.seg"><code class="xref py py-mod docutils literal notranslate"><span class="pre">sfftk.formats.seg</span></code></a> module has the following top level structure:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">.base</span> <span class="kn">import</span> <span class="n">Segmentation</span><span class="p">,</span> <span class="n">Header</span><span class="p">,</span> <span class="n">Segment</span><span class="p">,</span> <span class="n">Annotation</span><span class="p">,</span> <span class="n">Volume</span>
<span class="kn">import</span> <span class="nn">sfftkrw</span> <span class="k">as</span> <span class="nn">schema</span>
<span class="kn">from</span> <span class="nn">..readers</span> <span class="kn">import</span> <span class="n">segreader</span>

<span class="k">class</span> <span class="nc">SeggerAnnotation</span><span class="p">(</span><span class="n">Annotation</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="k">class</span> <span class="nc">SeggerVolume</span><span class="p">(</span><span class="n">Volume</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="k">class</span> <span class="nc">SeggerSegment</span><span class="p">(</span><span class="n">Segment</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="k">class</span> <span class="nc">SeggerHeader</span><span class="p">(</span><span class="n">Header</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="k">class</span> <span class="nc">SeggerSegmentation</span><span class="p">(</span><span class="n">Segmentation</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p>The <a class="reference internal" href="formats.html#sfftk.formats.seg.SeggerSegmentation" title="sfftk.formats.seg.SeggerSegmentation"><code class="xref py py-class docutils literal notranslate"><span class="pre">sfftk.formats.seg.SeggerSegmentation</span></code></a> class’s initialiser does the reading using the <a class="reference internal" href="readers.html#module-sfftk.readers.segreader" title="sfftk.readers.segreader"><code class="xref py py-mod docutils literal notranslate"><span class="pre">sfftk.readers.segreader</span></code></a> module described in <a class="reference internal" href="#step-i"><span class="std std-ref">Step I: Create a reader module</span></a>;</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SeggerSegmentation</span><span class="p">(</span><span class="n">Segmentation</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">top_level</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialise the reader&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fn</span> <span class="o">=</span> <span class="n">fn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_segmentation</span> <span class="o">=</span> <span class="n">segreader</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fn</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_top_level</span> <span class="o">=</span> <span class="n">top_level</span>
</pre></div>
</div>
<p>We then reference the <code class="docutils literal notranslate"><span class="pre">header</span></code> and <code class="docutils literal notranslate"><span class="pre">segments</span></code> attributes using propers to decouple the actual hosted objects from the user-facing attributes.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SeggerSegmentation</span><span class="p">(</span><span class="n">Segmentation</span><span class="p">):</span>
    <span class="c1"># ...</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">header</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The header for this segmentation&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">SeggerHeader</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_segmentation</span><span class="p">)</span>
</pre></div>
</div>
<p>and delegate the <a class="reference internal" href="formats.html#sfftk.formats.seg.SeggerHeader" title="sfftk.formats.seg.SeggerHeader"><code class="xref py py-class docutils literal notranslate"><span class="pre">sfftk.formats.seg.SeggerHeader</span></code></a> to expose header attributes.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SeggerHeader</span><span class="p">(</span><span class="n">Header</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Header class&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">segmentation</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_segmentation</span> <span class="o">=</span> <span class="n">segmentation</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The name of segmentation&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_segmentation</span><span class="o">.</span><span class="n">format</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">version</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The version of Segger used&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_segmentation</span><span class="o">.</span><span class="n">format_version</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">map_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The path to the original segmented map&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_segmentation</span><span class="o">.</span><span class="n">map_path</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">ijk_to_xyz_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The image-to-physical transform&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_segmentation</span><span class="o">.</span><span class="n">ijk_to_xyz_transform</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">file_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The path to the .seg file&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_segmentation</span><span class="o">.</span><span class="n">file_path</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">root_parent_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Parent IDs for root segments&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_segmentation</span><span class="o">.</span><span class="n">root_parent_ids</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">region_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;All region IDs&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_segmentation</span><span class="o">.</span><span class="n">region_ids</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">parent_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;All parent IDs&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_segmentation</span><span class="o">.</span><span class="n">parent_ids</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">map_size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Map dimensions&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_segmentation</span><span class="o">.</span><span class="n">map_size</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">mask</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_segmentation</span><span class="o">.</span><span class="n">mask</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">simplified_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_segmentation</span><span class="o">.</span><span class="n">simplify_mask</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="p">)</span>
</pre></div>
</div>
<p>Notice that all underlying functionality is obtained from the <em>ad hoc</em> reader, which does the heavy lifting. The adapter merely <em>adapts</em> the <em>ad hoc</em> <a class="reference internal" href="readers.html#sfftk.readers.segreader.SeggerSegmentation" title="sfftk.readers.segreader.SeggerSegmentation"><code class="xref py py-class docutils literal notranslate"><span class="pre">sfftk.readers.segreader.SeggerSegmentation</span></code></a> class for the EMDB-SFF schema.</p>
<p>Segments are contained in a list and exposed through the <code class="docutils literal notranslate"><span class="pre">segments</span></code> property of the <a class="reference internal" href="formats.html#sfftk.formats.seg.SeggerSegmentation" title="sfftk.formats.seg.SeggerSegmentation"><code class="xref py py-class docutils literal notranslate"><span class="pre">sfftk.formats.seg.SeggerSegmentation</span></code></a> class.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SeggerSegmentation</span><span class="p">(</span><span class="n">Segmentation</span><span class="p">):</span>
    <span class="c1"># ...</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">segments</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The segments in this segmentation&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_top_level</span><span class="p">:</span>
            <span class="n">segments</span> <span class="o">=</span> <span class="p">[</span><span class="n">SeggerSegment</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_segmentation</span><span class="p">,</span> <span class="n">region_id</span><span class="p">)</span> <span class="k">for</span> <span class="n">region_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">root_parent_ids</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">segments</span> <span class="o">=</span> <span class="p">[</span><span class="n">SeggerSegment</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_segmentation</span><span class="p">,</span> <span class="n">region_id</span><span class="p">)</span> <span class="k">for</span> <span class="n">region_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">region_ids</span> <span class="k">if</span>
                        <span class="n">region_id</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">segments</span>
</pre></div>
</div>
<p>To perform a conversion the <a class="reference internal" href="formats.html#sfftk.formats.seg.SeggerSegmentation" title="sfftk.formats.seg.SeggerSegmentation"><code class="xref py py-class docutils literal notranslate"><span class="pre">sfftk.formats.seg.SeggerSegmentation</span></code></a> class implements a <a class="reference internal" href="formats.html#sfftk.formats.seg.SeggerSegmentation.convert" title="sfftk.formats.seg.SeggerSegmentation.convert"><code class="xref py py-meth docutils literal notranslate"><span class="pre">sfftk.formats.seg.SeggerSegmentation.convert()</span></code></a> method that uses the EMDB-SFF schema API as described in <a class="reference internal" href="developing.html"><span class="doc">Developing with sfftk</span></a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SeggerSegmentation</span><span class="p">(</span><span class="n">Segmentation</span><span class="p">):</span>
    <span class="c1"># ...</span>

    <span class="k">def</span> <span class="nf">convert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Method to convert a :py:class:`sfftkrw.SFFSegmentation` object&quot;&quot;&quot;</span>
        <span class="n">segmentation</span> <span class="o">=</span> <span class="n">schema</span><span class="o">.</span><span class="n">SFFSegmentation</span><span class="p">()</span>
        <span class="n">segmentation</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Segger Segmentation&quot;</span>
        <span class="n">segmentation</span><span class="o">.</span><span class="n">software</span> <span class="o">=</span> <span class="n">schema</span><span class="o">.</span><span class="n">SFFSoftware</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">version</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">version</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">segmentation</span><span class="o">.</span><span class="n">transforms</span> <span class="o">=</span> <span class="n">schema</span><span class="o">.</span><span class="n">SFFTransformList</span><span class="p">()</span>
        <span class="n">segmentation</span><span class="o">.</span><span class="n">transforms</span><span class="o">.</span><span class="n">add_transform</span><span class="p">(</span>
            <span class="n">schema</span><span class="o">.</span><span class="n">SFFTransformationMatrix</span><span class="p">(</span>
                <span class="n">rows</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                <span class="n">cols</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                <span class="n">data</span><span class="o">=</span><span class="s1">&#39;1.0 0.0 0.0 1.0 0.0 1.0 0.0 1.0 0.0 0.0 1.0 1.0&#39;</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">segmentation</span><span class="o">.</span><span class="n">transforms</span><span class="o">.</span><span class="n">add_transform</span><span class="p">(</span>
            <span class="n">schema</span><span class="o">.</span><span class="n">SFFTransformationMatrix</span><span class="p">(</span>
                <span class="n">rows</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                <span class="n">cols</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                <span class="n">data</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">ijk_to_xyz_transform</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()))</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">segmentation</span><span class="o">.</span><span class="n">primaryDescriptor</span> <span class="o">=</span> <span class="s2">&quot;threeDVolume&quot;</span>
        <span class="n">segments</span> <span class="o">=</span> <span class="n">schema</span><span class="o">.</span><span class="n">SFFSegmentList</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">segments</span><span class="p">:</span>
            <span class="n">segment</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">convert</span><span class="p">()</span>
            <span class="n">segments</span><span class="o">.</span><span class="n">add_segment</span><span class="p">(</span><span class="n">segment</span><span class="p">)</span>
        <span class="c1"># finally pack everything together</span>
        <span class="n">segmentation</span><span class="o">.</span><span class="n">segments</span> <span class="o">=</span> <span class="n">segments</span>
        <span class="c1"># lattice</span>
        <span class="n">segmentation</span><span class="o">.</span><span class="n">lattices</span> <span class="o">=</span> <span class="n">schema</span><span class="o">.</span><span class="n">SFFLatticeList</span><span class="p">()</span>
        <span class="n">cols</span><span class="p">,</span> <span class="n">rows</span><span class="p">,</span> <span class="n">sections</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">map_size</span>
        <span class="n">lattice</span> <span class="o">=</span> <span class="n">schema</span><span class="o">.</span><span class="n">SFFLattice</span><span class="p">(</span>
            <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;uint32&#39;</span><span class="p">,</span>
            <span class="n">endianness</span><span class="o">=</span><span class="s1">&#39;little&#39;</span><span class="p">,</span>
            <span class="n">size</span><span class="o">=</span><span class="n">schema</span><span class="o">.</span><span class="n">SFFVolumeStructure</span><span class="p">(</span><span class="n">cols</span><span class="o">=</span><span class="n">cols</span><span class="p">,</span> <span class="n">rows</span><span class="o">=</span><span class="n">rows</span><span class="p">,</span> <span class="n">sections</span><span class="o">=</span><span class="n">sections</span><span class="p">),</span>
            <span class="n">start</span><span class="o">=</span><span class="n">schema</span><span class="o">.</span><span class="n">SFFVolumeIndex</span><span class="p">(</span><span class="n">cols</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">rows</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">sections</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
            <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">simplified_mask</span>
        <span class="p">)</span>
        <span class="n">segmentation</span><span class="o">.</span><span class="n">lattices</span><span class="o">.</span><span class="n">add_lattice</span><span class="p">(</span><span class="n">lattice</span><span class="p">)</span>
        <span class="c1"># details</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">details</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">segmentation</span><span class="o">.</span><span class="n">details</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">details</span>
        <span class="k">elif</span> <span class="s1">&#39;details&#39;</span> <span class="ow">in</span> <span class="n">_kwargs</span><span class="p">:</span>
            <span class="n">segmentation</span><span class="o">.</span><span class="n">details</span> <span class="o">=</span> <span class="n">_kwargs</span><span class="p">[</span><span class="s1">&#39;details&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">segmentation</span>
</pre></div>
</div>
<p>Notice that in the loop for each segment (<code class="docutils literal notranslate"><span class="pre">for</span> <span class="pre">s</span> <span class="pre">in</span> <span class="pre">self.segments</span></code>) we refer to each segment’s <code class="docutils literal notranslate"><span class="pre">convert()</span></code> method which is implemented as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SeggerSegment</span><span class="p">(</span><span class="n">Segment</span><span class="p">):</span>
    <span class="c1"># ...</span>

    <span class="k">def</span> <span class="nf">convert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Convert to a :py:class:`sfftkrw.SFFSegment` object&quot;&quot;&quot;</span>
        <span class="n">segment</span> <span class="o">=</span> <span class="n">schema</span><span class="o">.</span><span class="n">SFFSegment</span><span class="p">()</span>
        <span class="n">segment</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">region_id</span>
        <span class="n">segment</span><span class="o">.</span><span class="n">parentID</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_id</span>
        <span class="c1"># annotation</span>
        <span class="n">segment</span><span class="o">.</span><span class="n">annotation</span><span class="p">,</span> <span class="n">segment</span><span class="o">.</span><span class="n">colour</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">annotation</span><span class="o">.</span><span class="n">convert</span><span class="p">()</span>
        <span class="c1"># geometry</span>
        <span class="c1"># segment.volume = self.volume.convert()</span>
        <span class="n">segment</span><span class="o">.</span><span class="n">volume</span> <span class="o">=</span> <span class="n">schema</span><span class="o">.</span><span class="n">SFFThreeDVolume</span><span class="p">()</span>
        <span class="n">segment</span><span class="o">.</span><span class="n">volume</span><span class="o">.</span><span class="n">latticeId</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">segment</span><span class="o">.</span><span class="n">volume</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">region_id</span>
        <span class="k">return</span> <span class="n">segment</span>
</pre></div>
</div>
<p>and which in turn calls the <code class="docutils literal notranslate"><span class="pre">convert()</span></code> methods on the contained annotation and volume objects.</p>
</section>
</section>
<section id="step-iii-implement-a-convert-hook-in-the-sfftk-sff-handle-convert-function">
<span id="step-iii"></span><h3><a class="toc-backref" href="#id7">Step III: Implement a <strong>convert hook</strong> in the <code class="xref py py-func docutils literal notranslate"><span class="pre">sfftk.sff.handle_convert()</span></code> function</a><a class="headerlink" href="#step-iii-implement-a-convert-hook-in-the-sfftk-sff-handle-convert-function" title="Permalink to this heading"></a></h3>
<p>In order to perform conversion using the command-line utility, we need to have the <code class="docutils literal notranslate"><span class="pre">convert</span></code> utility recognise segmentations by file type. This is simply done by add adding a regular expression match object in the <code class="xref py py-func docutils literal notranslate"><span class="pre">sfftk.sff.handle_convert()</span></code> function as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">handle_convert</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">configs</span><span class="p">):</span>  <span class="c1"># @UnusedVariable</span>
    <span class="c1"># ...</span>
    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">multi_file</span><span class="p">:</span>
        <span class="c1"># segmentation file formats that support multi-file segmentations will be handled here</span>
        <span class="c1"># ...</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;.*\.mod$&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">from_file</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
            <span class="c1"># handle reading of IMOD files</span>
        <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;.*\.seg$&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">from_file</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
            <span class="kn">from</span> <span class="nn">.formats.seg</span> <span class="kn">import</span> <span class="n">SeggerSegmentation</span>
            <span class="n">seg</span> <span class="o">=</span> <span class="n">SeggerSegmentation</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">from_file</span><span class="p">,</span> <span class="n">top_level</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">top_level_only</span><span class="p">)</span>
        <span class="c1"># other file formats go here</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unknown file type </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">args</span><span class="o">.</span><span class="n">from_file</span><span class="p">)</span>
    <span class="c1"># export (convert first if needed)</span>
    <span class="c1"># ...</span>
    <span class="n">sff_seg</span><span class="o">.</span><span class="n">export</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">EX_OK</span>
</pre></div>
</div>
<p>Once this is done the following should work:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sff convert --top-level-only file.seg --verbose
</pre></div>
</div>
</section>
<section id="step-iv-add-test-data-files-to-the-sfftk-test-data-folder">
<span id="step-iv"></span><h3><a class="toc-backref" href="#id8">Step IV: Add test data files to the <code class="docutils literal notranslate"><span class="pre">sfftk/test_data</span></code> folder</a><a class="headerlink" href="#step-iv-add-test-data-files-to-the-sfftk-test-data-folder" title="Permalink to this heading"></a></h3>
<p>Provide an example segmentation file in the sfftk.test_data package.</p>
</section>
<section id="step-v-add-unit-tests-in-the-sfftk-unittests-module">
<span id="step-v"></span><h3><a class="toc-backref" href="#id9">Step V: Add unit tests in the <code class="xref py py-mod docutils literal notranslate"><span class="pre">sfftk.unittests</span></code> module</a><a class="headerlink" href="#step-v-add-unit-tests-in-the-sfftk-unittests-module" title="Permalink to this heading"></a></h3>
<p>Write unit tests and add them to the <code class="xref py py-mod docutils literal notranslate"><span class="pre">sfftk.unittests.test_formats</span></code> module. Each format that you add should implement a read and convert test method (respectively called <code class="docutils literal notranslate"><span class="pre">test_&lt;format&gt;_read</span></code> and <code class="docutils literal notranslate"><span class="pre">test_&lt;format&gt;_convert</span></code>. See the <code class="xref py py-mod docutils literal notranslate"><span class="pre">sfftk.unittests.test_formats</span></code> module for examples.</p>
<p>Of course, you are welcome to contact us for help doing the above. Also, if you have any suggestions on how to improve the extension process these are invited.</p>
<p>Once all this components are in place conversion to XML, HDF5 and JSON should be automatic.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sff convert file.&lt;format&gt; -f sff
sff convert file.&lt;format&gt; -f hff
sff convert file.&lt;format&gt; -f json
</pre></div>
</div>
<p>Also, tests can be run as follows:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sff tests formats
</pre></div>
</div>
</section>
</section>
<section id="adding-a-search-resource">
<h2><a class="toc-backref" href="#id10">Adding A Search Resource</a><a class="headerlink" href="#adding-a-search-resource" title="Permalink to this heading"></a></h2>
<p>The list of search resources is extensible. Any new search results must fulfil the following criteria:</p>
<ul class="simple">
<li><p>Have a A REST API;</p></li>
<li><p>Return the result as either JSON or TAB-delimitted text;</p></li>
</ul>
<section id="step-i-add-the-resource-description">
<h3><a class="toc-backref" href="#id11">Step I: Add the resource description</a><a class="headerlink" href="#step-i-add-the-resource-description" title="Permalink to this heading"></a></h3>
<p>The resource descriptions are contained in <code class="xref py py-mod docutils literal notranslate"><span class="pre">sfftk.notes.__init__.py</span></code>. For example, the one for
<a class="reference external" href="https://www.ebi.ac.uk/ols">OLS</a> is:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">RESOURCE_LIST</span><span class="p">[</span><span class="s1">&#39;ols&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;OLS&#39;</span><span class="p">,</span>
    <span class="s1">&#39;root_url&#39;</span><span class="p">:</span> <span class="s1">&#39;https://www.ebi.ac.uk/ols/api/&#39;</span><span class="p">,</span>
    <span class="s1">&#39;format&#39;</span><span class="p">:</span> <span class="s1">&#39;json&#39;</span><span class="p">,</span>
    <span class="s1">&#39;result_path&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;response&#39;</span><span class="p">,</span> <span class="s1">&#39;docs&#39;</span><span class="p">],</span>
    <span class="s1">&#39;result_count&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;response&#39;</span><span class="p">,</span> <span class="s1">&#39;numFound&#39;</span><span class="p">],</span>
<span class="p">}</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">RESOURCE_LIST</span></code> is a dictionary whose primary key is the lower-case abbreviation of the resource name (<code class="docutils literal notranslate"><span class="pre">ols</span></code> here).
Each resource’s description is a dictionary of:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">name</span></code> - proper abbreviation of the resource’s name (<code class="docutils literal notranslate"><span class="pre">UniProt</span></code> not <code class="docutils literal notranslate"><span class="pre">Uniprot</span></code>);</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">root_url</span></code> - the part of the REST API which is invariant i.e. excluding search parameters;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">format</span></code> - either <code class="docutils literal notranslate"><span class="pre">json</span></code> or <code class="docutils literal notranslate"><span class="pre">tab</span></code>;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">result_path</span></code> - the part of the response data that contains a list of results. In the above example,
<code class="docutils literal notranslate"><span class="pre">response</span></code>, <code class="docutils literal notranslate"><span class="pre">docs</span></code> are a path to a list element of the JSON where all results are found. If <code class="docutils literal notranslate"><span class="pre">format</span></code> is
<code class="docutils literal notranslate"><span class="pre">tab</span></code> set this to <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">result_count</span></code> - the part of the response data that contains the count of the complete results. Usually only a
page of all results is returned but it is useful to inform the user of how many results were found. If this is not
present set it to <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p></li>
</ul>
</section>
<section id="step-ii-add-a-handler-to-return-the-correct-url">
<h3><a class="toc-backref" href="#id12">Step II: Add a handler to return the correct URL</a><a class="headerlink" href="#step-ii-add-a-handler-to-return-the-correct-url" title="Permalink to this heading"></a></h3>
<p>Modify the <code class="xref py py-class docutils literal notranslate"><span class="pre">sfftk.notes.find.SearchResults.get_url()</span></code> method by adding a conditional handler for
the resource that returns the complete search URL (i.e. including the search term and additional options allowed on the
REST API).</p>
<p>The <code class="docutils literal notranslate"><span class="pre">if</span></code> statement uses the resource name to identify the resource.</p>
<p>For example, the URL for OLS is generated as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># ols</span>
<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;OLS&#39;</span><span class="p">:</span>
    <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_url</span> <span class="o">+</span> <span class="s2">&quot;search?q=</span><span class="si">{}</span><span class="s2">&amp;start=</span><span class="si">{}</span><span class="s2">&amp;rows=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">search_args</span><span class="o">.</span><span class="n">search_term</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">search_args</span><span class="o">.</span><span class="n">start</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">search_args</span><span class="o">.</span><span class="n">rows</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_args</span><span class="o">.</span><span class="n">ontology</span><span class="p">:</span>
        <span class="n">url</span> <span class="o">+=</span> <span class="s2">&quot;&amp;ontology=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">search_args</span><span class="o">.</span><span class="n">ontology</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_args</span><span class="o">.</span><span class="n">exact</span><span class="p">:</span>
        <span class="n">url</span> <span class="o">+=</span> <span class="s2">&quot;&amp;exact=on&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_args</span><span class="o">.</span><span class="n">obsoletes</span><span class="p">:</span>
        <span class="n">url</span> <span class="o">+=</span> <span class="s2">&quot;&amp;obsoletes=on&quot;</span>
</pre></div>
</div>
<p>Each of the subsequent <code class="docutils literal notranslate"><span class="pre">if</span></code> statements conditionally include additional parameters specified in the command-line
arguments.</p>
</section>
<section id="step-iii-define-how-the-table-is-formated">
<h3><a class="toc-backref" href="#id13">Step III: Define how the table is formated</a><a class="headerlink" href="#step-iii-define-how-the-table-is-formated" title="Permalink to this heading"></a></h3>
<p>The <code class="xref py py-meth docutils literal notranslate"><span class="pre">sfftk.notes.find.SearchResource.tabulate()</span></code> specifies how to tabulate results from each resource. We use
two classes: <a class="reference internal" href="notes.html#sfftk.notes.find.TableField" title="sfftk.notes.find.TableField"><code class="xref py py-class docutils literal notranslate"><span class="pre">sfftk.notes.find.TableField</span></code></a> and <a class="reference internal" href="notes.html#sfftk.notes.find.ResultsTable" title="sfftk.notes.find.ResultsTable"><code class="xref py py-class docutils literal notranslate"><span class="pre">sfftk.notes.find.ResultsTable</span></code></a> to do this. Here is
an example for OLS:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resource</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;OLS&#39;</span><span class="p">:</span>
    <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">TableField</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;index&#39;</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="sa">u</span><span class="s1">&#39;index&#39;</span><span class="p">,</span> <span class="n">pc</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">is_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">justify</span><span class="o">=</span><span class="sa">u</span><span class="s1">&#39;right&#39;</span><span class="p">),</span>
            <span class="n">TableField</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;label&#39;</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="sa">u</span><span class="s1">&#39;label&#39;</span><span class="p">,</span> <span class="n">pc</span><span class="o">=</span><span class="mi">10</span><span class="p">),</span>
            <span class="n">TableField</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;resource&#39;</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="sa">u</span><span class="s1">&#39;ontology_name&#39;</span><span class="p">,</span> <span class="n">pc</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">justify</span><span class="o">=</span><span class="sa">u</span><span class="s1">&#39;center&#39;</span><span class="p">),</span>
            <span class="n">TableField</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;url&#39;</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="sa">u</span><span class="s1">&#39;iri&#39;</span><span class="p">,</span> <span class="n">pc</span><span class="o">=</span><span class="mi">30</span><span class="p">),</span>
            <span class="n">TableField</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;accession&#39;</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="sa">u</span><span class="s1">&#39;short_form&#39;</span><span class="p">,</span> <span class="n">pc</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">justify</span><span class="o">=</span><span class="sa">u</span><span class="s1">&#39;center&#39;</span><span class="p">),</span>
            <span class="n">TableField</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;description&#39;</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="sa">u</span><span class="s1">&#39;description&#39;</span><span class="p">,</span> <span class="n">pc</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">is_iterable</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
        <span class="p">]</span>
    <span class="n">table</span> <span class="o">+=</span> <span class="n">_str</span><span class="p">(</span><span class="n">ResultsTable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fields</span><span class="o">=</span><span class="n">fields</span><span class="p">))</span>
</pre></div>
</div>
<p>You will need to refer to the resource’s REST API documentation to match result fields with table fields.</p>
<p><a class="reference internal" href="notes.html#sfftk.notes.find.TableField" title="sfftk.notes.find.TableField"><code class="xref py py-class docutils literal notranslate"><span class="pre">sfftk.notes.find.TableField</span></code></a> accepts the following arguments:</p>
<ul>
<li><p>The first (positional) argument is the name of the field and appears in the table header;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">key</span></code> is the official name of the field in the REST API; the <a class="reference internal" href="notes.html#sfftk.notes.find.TableField" title="sfftk.notes.find.TableField"><code class="xref py py-class docutils literal notranslate"><span class="pre">sfftk.notes.find.TableField</span></code></a> uses the key
to extract the row values;</p></li>
<li><p>Instead of using the <code class="docutils literal notranslate"><span class="pre">key</span></code> argument, the user may use <code class="docutils literal notranslate"><span class="pre">text</span></code> which will be a fixed value for all rows;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pc</span></code> is the field width in <em>percent</em>; alternatively, use the <code class="docutils literal notranslate"><span class="pre">width</span></code> argument to specify how many characters
wide the field should be;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">is_index</span></code> sets the field to be an index field i.e. to show the row number;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">justify</span></code> can either be <code class="docutils literal notranslate"><span class="pre">right</span></code>, <code class="docutils literal notranslate"><span class="pre">left</span></code> or <code class="docutils literal notranslate"><span class="pre">center</span></code> and specifies the field text alignment;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">_format</span></code> specifies a <em>format string</em> (a string with with <code class="docutils literal notranslate"><span class="pre">{}</span></code> which will replace <code class="docutils literal notranslate"><span class="pre">{}</span></code> with the field value.
This is helpful when creating URLs/IRIs to an accession page e.g.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">TableField</span><span class="p">(</span><span class="s1">&#39;url&#39;</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s1">&#39;EntryID&#39;</span><span class="p">,</span> <span class="n">_format</span><span class="o">=</span><span class="s1">&#39;https://www.ebi.ac.uk/pdbe/emdb/EMD-</span><span class="si">{}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">pc</span><span class="o">=</span><span class="mi">30</span><span class="p">),</span>
</pre></div>
</div>
<p>for an EMDB entry page.</p>
</li>
</ul>
</section>
<section id="step-iv-write-tests-and-test">
<h3><a class="toc-backref" href="#id14">Step IV: Write tests and test</a><a class="headerlink" href="#step-iv-write-tests-and-test" title="Permalink to this heading"></a></h3>
<p>You will then need to write at least two tests in the <code class="docutils literal notranslate"><span class="pre">sfftk.unittests.test_notes.TestNotesFindSearchResource</span></code> class:</p>
<ul class="simple">
<li><p><em>parser</em> tests that check that the command-line arguments are correct (see the module for other examples);</p></li>
<li><p><em>get_url</em> tests that ensure that the URL is correctly formed for all options;</p></li>
</ul>
</section>
<section id="step-iv-write-documentation-for-the-new-resource">
<h3><a class="toc-backref" href="#id15">Step IV: Write documentation for the new resource</a><a class="headerlink" href="#step-iv-write-documentation-for-the-new-resource" title="Permalink to this heading"></a></h3>
<p>Finally, document the resource in the section <a class="reference internal" href="annotating.html#specifying-the-resource-to-search"><span class="std std-ref">Specifying The Resource To Search</span></a> by describing the following:</p>
<ul class="simple">
<li><p>the <em>name</em> and <em>link to</em> the resource in the list of resources;</p></li>
<li><p>the <em>keyword</em> to be passed to the <code class="docutils literal notranslate"><span class="pre">-R/--resource</span></code> flag;</p></li>
</ul>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="developing.html" class="btn btn-neutral float-left" title="Developing with sfftk" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="sfftk.html" class="btn btn-neutral float-right" title="sfftk packages" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2017, EMBL-EBI.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>